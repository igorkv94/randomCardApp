function chooseImg(e){promises.push(new Promise(function(n,r){var o=randomWords();new Instafeed({get:"tagged",tagName:o,accessToken:"3848585827.ba4c844.d0d3e1b6e8614518b92e464cb1ce3031",target:preId+e,resolution:"low_resolution",limit:1,template:'<figure class="'+backClass+'"><a href="{{link}}"><img src="{{image}}" /></a></figure>',after:function(r){var o=document.getElementById(preId+e).getElementsByClassName(backClass)[0],a=randomId(preCard);preCard.splice(preCard.indexOf(a),1);var d=o.cloneNode(!0);document.getElementById(preId+a).appendChild(d),n()},error:function(){r(new Error("Error in API!"))}}).run()}))}function CardInfo(e,n){this.getId=function(){return e},this.getSrc=function(){return n}}function nextStep(){if(console.log("Step "+step),0===step)flip(fId=randomId()),fSrc=getSrc(fId),console.log("F "+fId);else if(1===step)secId=chooseSecondCard(fId,fSrc),console.log("ATTENTION"),console.log("F "+fId),console.log("S "+secId),flip(secId),secSrc=getSrc(secId);else if(console.log("F "+fId),console.log("S "+secId),fSrc===secSrc){if(hide(fId),hide(secId),deleteCards(fId,secId),console.log("deleteCard Done"),0===remainingCard.length){clearInterval(curInterval),saved=[];for(var e=0;e<count;e++){remainingCard.push(e),preCard.push(e),flip(e),hide(e);var n=document.getElementById(preId+e).getElementsByClassName(backClass)[0];n.parentNode.removeChild(n)}var r=count/2;for(e=0;e<r;e++){var o=randomId(preCard);preCard.splice(preCard.indexOf(o),1),chooseImg(o)}Promise.all(promises).then(function(e){curInterval=setInterval(nextStep,interval),promises=[]}),console.log("restart Done")}}else flip(fId),flip(secId),addCard(fId,fSrc),addCard(secId,secSrc);console.log("Done"),3===++step&&(step=0)}function randomId(e){e=void 0!==e?e:remainingCard,console.log(e),console.log(remainingCard);var n=Math.floor(Math.random()*e.length);return console.log(n),e[n]}function getSrc(e){return console.log(e),document.getElementById(preId+e).getElementsByClassName(backClass)[0].getElementsByTagName("img")[0].getAttribute("src")}function flip(e){document.getElementById(preId+e).classList.toggle("flipped")}function hide(e){document.getElementById(preId+e).classList.toggle("hide")}function addCard(e,n){saved.some(function(n){return n.getId()===e});saved.push(new CardInfo(e,n))}function deleteCards(e,n){remainingCard.splice(remainingCard.indexOf(e),1),remainingCard.splice(remainingCard.indexOf(n),1),console.log(remainingCard),saved.forEach(function(e,r,o){e.getId()===n&&o.splice(r,1)}),console.log(saved)}function havingPair(e,n){var r=-1;return saved.forEach(function(o,a,d){o.getId()!==e&&o.getSrc()===n&&(r=o.getId())}),remainingCard.indexOf(r)}function chooseSecondCard(e,n){var r=havingPair(e,n);if(-1===r){if(0===saved.length){var o=remainingCard.slice();return o.splice(o.indexOf(e),1),console.log("OOOOOOOOOOOOOOOOOOO "+remainingCard),console.log("OOOOOOOOOOOOOOOOOOO "+o),randomId(o)}var a=saved.map(function(e){return e.getId()});a.push(fId);var d=remainingCard.filter(function(e){return!a.includes(e)});return console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA "),console.log("ERROR in "+a),r=randomId(d),console.log("ERROR in "+r),console.log("ERROR in "+r),console.log("ERROR in "+r),r}return console.log("BBBBBBBBBBBBBBBBBBBBBBBBBB "),remainingCard[r]}var preId="card-flip-",backClass="back",count,promises=[],preCard=[],interval=1e3,curInterval,remainingCard=[],saved=[],fSrc,secSrc,fId,secId;window.onload=function(){count=document.getElementsByClassName("card").length;for(var e=0;e<count;e++)remainingCard.push(e),preCard.push(e);var n=count/2;for(e=0;e<n;e++){var r=randomId(preCard);preCard.splice(preCard.indexOf(r),1),chooseImg(r)}Promise.all(promises).then(function(e){curInterval=setInterval(nextStep,interval),promises=[]})};var step=0;